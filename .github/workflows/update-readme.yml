name: Update README with Stats
on:
  schedule:
    - cron: '0 8 * * 1'  # Toda segunda-feira, 08:00 UTC
  workflow_dispatch:      # Permite execu√ß√£o manual
  push:
    branches:
      - main  # Opcional: tamb√©m executa ao fazer push para main

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Permiss√£o ESSENCIAL para fazer push
    steps:
      - name: Checkout do reposit√≥rio
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Baixa todo o hist√≥rico (√∫til para scripts git)

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
            - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # üëá ADICIONE ESTE PASSO AQUI
      - name: Instalar depend√™ncias
        run: pip install requests

      - name: Executar script de atualiza√ß√£o
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: python .github/scripts/update_readme.py
      - name: Executar script de atualiza√ß√£o
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Token fornecido automaticamente
        run: python .github/scripts/update_readme.py

      - name: Fazer commit e push das altera√ß√µes
        if: success()  # S√≥ executa se o passo anterior teve sucesso
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          # Cria commit APENAS se houver mudan√ßas
          git diff --staged --quiet || (git commit -m "üìà docs(README): atualiza√ß√£o autom√°tica de reposit√≥rios e linguagens" && git push)
